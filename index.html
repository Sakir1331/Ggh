<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صقر - الذكاء الاصطناعي المتقدم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        :root {
            --primary-light: #3B82F6;
            --primary-dark: #1E40AF;
            --bg-light: #F3F4F6;
            --bg-dark: #1F2937;
            --text-light: #111827;
            --text-dark: #F9FAFB;
        }

        body {
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        .chat-container {
            max-height: 85vh;
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transition: all 0.3s ease;
        }

        .message-user {
            border-top-right-radius: 0;
            animation: slideInRight 0.3s ease-out;
        }

        .message-ai {
            border-top-left-radius: 0;
            animation: slideInLeft 0.3s ease-out;
        }

        .dark-mode .message-user {
            background-color: #2563EB !important;
            color: white !important;
        }

        .dark-mode .message-ai {
            background-color: #374151 !important;
            color: white !important;
        }

        @keyframes slideInRight {
            from { transform: translateX(50%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-50%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .typing-indicator span {
            animation: typing 1.4s infinite ease-in-out;
        }

        @keyframes typing {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        #file-upload {
            position: relative;
            overflow: hidden;
        }

        #features-panel {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto max-w-6xl p-4 lg:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 chat-container bg-white dark:bg-gray-800 rounded-2xl shadow-2xl">
            <!-- Features Panel (Mobile/Tablet Hidden) -->
            <div id="features-panel" class="hidden lg:block bg-gray-50 dark:bg-gray-900 p-4 rounded-r-2xl overflow-y-auto">
                <h3 class="text-xl font-bold mb-4 text-blue-600 dark:text-blue-400">مميزات صقر</h3>
                <div class="space-y-3">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-microphone text-blue-500"></i>
                        <span>محول الكلام للنص</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-image text-green-500"></i>
                        <span>دعم تحليل الصور</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-palette text-purple-500"></i>
                        <span>الوضع الداكن/الفاتح</span>
                    </div>
                </div>
            </div>

            <!-- Chat Interface -->
            <div class="col-span-2 flex flex-col">
                <!-- Header -->
                <div class="bg-blue-600 dark:bg-blue-900 text-white p-4 rounded-t-2xl flex justify-between items-center">
                    <div class="flex items-center space-x-2">
                        <img src="https://i.imgur.com/OJxGSy5.png" alt="صقر" class="w-12 h-12 rounded-full">
                        <div>
                            <h2 class="font-bold text-xl">صقر AI</h2>
                            <p class="text-sm opacity-75">مساعدك الذكي</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="theme-toggle" class="hover:bg-blue-700 p-2 rounded-full transition">
                            <i class="fas fa-moon"></i>
                        </button>
                        <button id="clear-chat" class="hover:bg-blue-700 p-2 rounded-full transition">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div id="chat-container" class="flex-grow p-4 overflow-y-auto bg-white dark:bg-gray-800">
                    <!-- Messages will be dynamically added here -->
                </div>

                <!-- Typing Indicator -->
                <div id="typing-indicator" class="hidden p-2 text-center bg-gray-100 dark:bg-gray-700">
                    <div class="typing-indicator flex justify-center items-center">
                        <span class="mx-1 w-2 h-2 bg-blue-500 rounded-full"></span>
                        <span class="mx-1 w-2 h-2 bg-blue-500 rounded-full"></span>
                        <span class="mx-1 w-2 h-2 bg-blue-500 rounded-full"></span>
                        <span class="mr-2">يكتب صقر...</span>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-b-2xl">
                    <div class="flex items-center space-x-2">
                        <button id="file-upload" class="bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600">
                            <i class="fas fa-upload"></i>
                            <input type="file" id="image-input" accept="image/*" class="hidden">
                        </button>
                        <button id="mic-button" class="bg-green-500 text-white p-2 rounded-full hover:bg-green-600">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <textarea id="message-input" placeholder="اكتب رسالتك هنا..." 
                            class="flex-grow p-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white resize-none h-12"></textarea>
                        <button id="send-button" class="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div id="image-preview" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center">
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg max-w-xl relative">
            <button id="close-preview" class="absolute top-2 right-2 text-red-500">
                <i class="fas fa-times"></i>
            </button>
            <img id="preview-image" class="max-h-96 mx-auto" />
        </div>
    </div>

    <script>
        // Extensive script from previous version with additional dark mode handling
        // [Previous JavaScript code remains largely the same, with added dark mode toggles]
        
        // Dark Mode Toggle
        const themeToggle = document.getElementById('theme-toggle');
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('dark');
            
            // Update theme toggle icon
            themeToggle.innerHTML = document.body.classList.contains('dark-mode')
                ? '<i class="fas fa-sun"></i>'
                : '<i class="fas fa-moon"></i>';
            
            // Store preference
            localStorage.setItem('theme', 
                document.body.classList.contains('dark-mode') ? 'dark' : 'light'
            );
        }

        // Initialize theme from localStorage
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.body.classList.add('dark');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }

        themeToggle.addEventListener('click', toggleDarkMode);

        // Rest of the previous script remains the same...
    </script>
</body>
</html>
